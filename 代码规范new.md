# 代码规范

# 前言

机器人编程有机器人行业自身的需求和特点，而现有的计算机或互联网行业编程规范不一定能够覆盖这些需求特点。编程规范的目的除了统一代码的外在形式，还应具备提高编程效率的内在优点，而现有的各类编程规范在一些习惯上并不统一，也说明这些计算机或互联网编程规范并没有收敛到最优方案。因此机器人作为新兴领域，有必要形成一套易读、易用、能为全行业提高效率的代码规范。
机器人编程中，存在计算机领域通用的业务密集类编程需求，也存在控制逻辑、矩阵计算、规划优化等计算密集类编程需求，其各自特点并不能被充分统一，因此本规范中对编程风格分为严格、建议两种分类，对业务密集与计算密集两种场景做出一定区分。

# 1. 总则

* 最小完备性：功能完备、代码最简、结构简明，每一个字符（包括空白字符）、每一处结构都有价值。
* 对人：易读。
* 对机器：高效。


# 2. 单位制与坐标系

* 核心思想：所见即所有，便于阅读
* 严格
  ① 在无说明情况下，必须采用原级单位及其衍生单位，长度(米)、角度(弧度)，时间(秒)，质量(千克)、力(牛)，扭矩(牛米)。
  ② 特殊使用情况下，在变量命名上须体现出单位制特征，如毫秒、数据传输协议放缩等。
  ③ 直角坐标系：z向上，x向前，右手系。
  ④ 旋转坐标系：右手螺旋为正。
  ⑤ 欧拉角顺序为zyx，分别对应航向yaw、俯仰pit、横滚rol

# 3. 文件

  核心思想：具有辨识度，命名便于键入与结合 tab 键使用，项目内便于查找查看。
* 严格：
  ① 命名首字母小写，便于键入。
  ② 多单词命名使用下划线分割，便于tab。
  ③ 代码文件按设计功能分组存放于不同文件夹，头文件、源文件采用同名，存放于同一文件夹，便于查找查看。
* 建议
  ① 有潜在相似文件命名，原始文件以下划线结尾，便于拓展。
  ② 第三方库编译好后集成到项目内（跨平台需多份），以便于迁移。

# 4. 变量命名

* 核心思想：具有辨识度，结构紧凑，逻辑合理，便于阅读。
* 严格（计算密集场景）：
  ① 小驼峰命名，不使用下划线，从而避免信息密度过低，整体观感混乱。
  ② 除③外，一律首字母小写，便于键入。
  ③ 仅两种情况允许首字母大写：
  (A) 矩阵，匹配数学含义一目了然。
  (B) 具有全局意义的量：namespace、#define、const 等。其中#define 使用大驼峰，严禁全大写，以免造成阅读不便。
  ④ struct 用于数据结构，可包含 init、reset 等基本方法，不包含复杂逻辑。
  class 用于具备逻辑运算功能的封装。
  ⑤ 固定一些常用缩写词缀：cmd-(命令值)、tgt-(目标值)、act-(实际值)、est-(估计值)等前缀，-P(位置)、-V(速度)、-W(角速度)、-F(力)、-T(关节扭矩)、-M(空间力矩)等后缀。
* 建议
  ④ class、struct 本体定义以-Class、-Struct 结尾。

# 5. 代码结构

* 核心思想：结构紧凑节约屏幕空间，逻辑合理，便于阅读。
* 严格
  ① 函数的左花括号紧跟主体，而不是另起一行，尤其是“}else{"字段，必须置于单行，以充分利用屏幕纵向空间的有效行数。
  ② if、for等主体必须加花空号（即便仅有单行函数体），便于阅读与二次拓展，避免错位。
  ③ 缩进对齐。
  ④ 任何表达式中，不使用无意义空格。
  (A) if后、圆括号、花括号周围等不使用空格，例如：

  ```
  badFun ( int bad ) { //函数名后、圆括号、花括号周围，空格无任何意义，圆括号、花括号与前后的符号本身即为一体结构，不存在添加空格会清晰的说法
  if (bad ) {          //if、for等关键词应与函数名写法结构一致，同样不应存在割裂
  goodFun(int good){   //紧凑行文即可
  ```

  (B) 空格仅用于计算逻辑分割或对齐，例如：
  ```
  bad =abc * bcde * cde + de * efgh / fghi - gh * hij - ij;//所有运算符都有空格，逻辑松散不明
  good=abc*bcde*cde +de*efgh/fghi -gh*hij -ij;             //+-号前空格用于区分计算逻辑块
  nice=abcd, bcde, cdef,  //逗号后正数带空格
       -def,-efgh,-fghi,  //逗号后负数可不带空格
        -gh,    h, -hij;  //短变量逗号后多个空格
  // 上面，等号周围空格用于行对齐而非死板地添加、注释前空格用于行对齐, 逗号后灵活使用空格用于行列对齐等
  ```
* 建议
  ① 函数参数组中，空格数量可以是0个、1个、多个，以保证多行之间对齐。

# 6. 逻辑结构（最重要）

* 核心思想：结构逻辑合理，便于人类阅读以及机器执行效率。
* 严格
  ① 模块功能封装（面向对象）。
  ② 调用逻辑紧凑（面向过程）。
  ③ 不常用的库不要 include 到*.h 文件污染全局。可采用 imp 封装在.cpp 内。
  ④ 避免对象或函数过多层级、多文件分散嵌套，造成阅读障碍。
  ⑤ 当单文件超过1000行时，需考虑进行模块拆分与独立封装。
* 建议
  ① 减少复杂模板使用，造成阅读不便。
  ② 减少飞针（指针传递）使用，包括传统指针和现代指针在内的 cast、move 语义等，避免造成阅读识别障碍与阅读逻辑混淆。
  ③ 利用单例设计模式，封装带有唯一性、或跨域需求的模块。
  
